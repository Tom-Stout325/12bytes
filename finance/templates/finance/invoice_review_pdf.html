{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    @page { size: 8.5in 11in; margin: 1in; }
    body { font-family: "Segoe UI", sans-serif; font-size: 12px; color: #333; margin: 0; }
    .header { text-align: center; border-bottom: 2px solid #4682B4; padding-bottom: 10px; margin-bottom: 20px; }
    .header img { width: 140px; }
    .header h2 { color: #4682B4; margin-top: 10px; font-size: 20px; }
    .header h3 { font-size: 16px; margin: 5px 0; }
    .section-title { background-color: #4682B4; color: white; padding: 6px 12px; margin-top: 30px; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 11.5px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background-color: #f4f4f4; }
    .summary { margin-top: 20px; border-top: 2px solid #ccc; padding-top: 10px; }
    .summary p { font-weight: bold; font-size: 13px; }
    .net-amount { font-size: 13.5px; color: #2E8B57; }
    .footer { font-size: 10px; text-align: center; margin-top: 40px; color: #777; }
  </style>
</head>
<body>
  <div class="header">
    <img src="{% static 'images/logo2.png' %}" alt="Airborne Images Logo">
    <h2>Invoice Summary</h2>
    <h3>Invoice #: {{ invoice.invoice }}</h3>
  </div>
  <div class="section-title">Invoice Information</div>
  <p><strong>Date:</strong> {{ invoice.date }}</p>
  <p><strong>Client:</strong> {{ invoice.client }}</p>
  <p><strong>Event:</strong> {{ invoice.event }}</p>
  <p><strong>Service:</strong> {{ invoice.service }}</p>
  <p><strong>Invoice Amount:</strong> ${{ invoice.amount|floatformat:2|intcomma }}</p>

  <div class="section-title">Associated Transactions</div>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Sub-Category</th>
        <th>Amount</th>
        <th>Deductible</th>
      </tr>
    </thead>
    <tbody>
      {% for t in transactions %}
      <tr>
        <td>{{ t.date }}</td>
        <td>{{ t.category }}</td>
        <td>{{ t.sub_cat }}</td>
        <td>
          ${{ t.amount|floatformat:2 }}
          {% if t.sub_cat.slug == 'meals' %}
            <br><small>(50% deductible: ${{ t.deductible_amount|floatformat:2 }})</small>
          {% endif %}
        </td>
        <td>
          {% if t.sub_cat.slug == 'meals' %}
            50%
          {% elif t.sub_cat.slug == 'fuel' and t.transport_type == 'personal_vehicle' %}
            No
          {% else %}
            Yes
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5">No transactions found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% if mileage_entries %}
  <div class="section-title">Mileage Entries</div>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Total Miles</th>
        <th>Rate</th>
        <th>Value</th>
        <th>Client</th>
        <th>Invoice</th>
        <th>Job</th>
      </tr>
    </thead>
    <tbody>
      {% for m in mileage_entries %}
      <tr>
        <td>{{ m.date }}</td>
        <td>{{ m.total }}</td>
        <td>${{ mileage_rate|floatformat:2 }}</td>
        <td>${{ m.total|floatformat:2|add:"0"|floatformat:2|floatformat:2|intcomma }}</td>
        <td>{{ m.client }}</td>
        <td>{{ m.invoice }}</td>
        <td>{{ m.job }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <div class="summary">
    <table>
      <tr>
        <td style="vertical-align: top; width: 50%;">
          <strong>Taxable Calculation</strong>
          <p>Invoice Amount: ${{ invoice_amount|floatformat:2|intcomma }}</p>
          <p>Taxable Expenses: -${{ deductible_expenses|floatformat:2|intcomma }}</p>
          <p>Mileage Deduction: -${{ mileage_dollars|floatformat:2|intcomma }}</p>
          <p class="net-amount">Taxable Income: ${{ taxable_income|floatformat:2|intcomma }}</p>
        </td>
        <td style="vertical-align: top; width: 50%;">
          <strong>Actual Calculation</strong>
          <p>Invoice Amount: ${{ invoice_amount|floatformat:2|intcomma }}</p>
          <p>Total Expenses: -${{ total_expenses|floatformat:2|intcomma }}</p>
          <p class="net-amount">Net Income: ${{ net_income|floatformat:2|intcomma }}</p>
        </td>
      </tr>
    </table>
  </div>

  <div class="footer">
    Generated by Airborne Images â€¢ {{ now|date:"F j, Y" }}
  </div>
</body>
</html>
